<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <title>jaden dot com</title>
    <style>
        body {
            height: 100vh;
            width: 100vw;
        }

        #room {
            position: absolute;
            z-index: -2;
            height: auto;
            width: 1400px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .walkable {
            position: absolute;
            z-index: 1;
            height: 100%;
            width: 100%;
            clip-path: polygon(0 75%, 25% 50%, 50% 60%, 75% 50%, 100% 75%, 50% 100%);
            
        }

        #me {
            position: absolute;
            top: 0;
            left: 0;
            transition: top 0.1s linear, left 0.1s linear;
        }
    </style>
</head>
<body>
    <div class="walkable"> </div>
    <img id="me" src="sprites/character-me-still-front-left.svg" alt="a pixel art character of the website's creator">
    <img id="room" src="scenes/homepage.svg" alt="a drawing of a museum room which serves as the site's homepage">

    <script>
        let isArrowRightPressed = false;
        let isArrowLeftPressed = false;
        let isArrowUpPressed = false;
        let isArrowDownPressed = false;
        let playerChar = document.getElementById('me');
        let facingLeft = true;
        let currentFrame = 0;
        let lastTimestamp = 0;
        let frameRate = 3;
        let step = 3;

        document.addEventListener('keydown', function(event) {
            switch(event.key) {
                case 'ArrowRight':
                case 'd':
                case 'D':
                    event.preventDefault();
                    isArrowRightPressed = true;
                    facingLeft = false;
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    event.preventDefault();
                    isArrowLeftPressed = true;
                    facingLeft = true;
                    break;
                case 'ArrowUp':
                case 'w':
                case 'W':
                    event.preventDefault();
                    isArrowUpPressed = true;
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    event.preventDefault();
                    isArrowDownPressed = true;
                    break;
            }
        });

        document.addEventListener('keyup', function(event) {
            switch(event.key) {
                case 'ArrowRight':
                case 'd':
                case 'D':
                    isArrowRightPressed = false;
                    playerChar.src = 'sprites/character-me-still-front-right.svg';
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    isArrowLeftPressed = false;
                    playerChar.src = 'sprites/character-me-still-front-left.svg';
                    break;
                case 'ArrowUp':
                case 'w':
                case 'W':
                    isArrowUpPressed = false;
                    if (facingLeft) {
                        playerChar.src = 'sprites/character-me-still-front-left.svg'
                    }
                    if (!facingLeft) {
                        playerChar.src = 'sprites/character-me-still-front-right.svg'
                    }
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    isArrowDownPressed = false;
                    if (facingLeft) {
                        playerChar.src = 'sprites/character-me-still-front-left.svg'
                    }
                    if (!facingLeft) {
                        playerChar.src = 'sprites/character-me-still-front-right.svg'
                    }                    
                    break;
            }
        });

        function moveCharacter(timestamp) {
            let elapsedMilliseconds = timestamp - lastTimestamp;
            let elapsedSeconds = elapsedMilliseconds / 1000;
            let frameTime = 1 / frameRate;

            if (elapsedSeconds >= frameTime) {
                currentFrame = (currentFrame === 1) ? 2 : 1;

                if (isArrowRightPressed) {
                    playerChar.src = `sprites/character-me-walking-front-right${currentFrame}.svg`;
                } else if (isArrowLeftPressed) {
                    playerChar.src = `sprites/character-me-walking-front-left${currentFrame}.svg`;
                } else if (isArrowUpPressed || isArrowDownPressed) {
                    if (facingLeft) {
                        playerChar.src = `sprites/character-me-walking-front-left${currentFrame}.svg`;
                    } else {
                        playerChar.src = `sprites/character-me-walking-front-right${currentFrame}.svg`;
                    }
                }

                lastTimestamp = timestamp;
            }

            let moveX = (isArrowRightPressed ? 1 : 0) - (isArrowLeftPressed ? 1 : 0);
            let moveY = (isArrowDownPressed ? 1 : 0) - (isArrowUpPressed ? 1 : 0);
            let length = Math.sqrt(moveX * moveX + moveY * moveY);
            let normalizedMoveX = length === 0 ? 0 : moveX / length;
            let normalizedMoveY = length === 0 ? 0 : moveY / length;

            let newLeft = (parseInt(playerChar.style.left) || 0) + normalizedMoveX * step;
            let newTop = (parseInt(playerChar.style.top) || 0) + normalizedMoveY * step;

            let roomWidth = document.querySelector('.walkable').offsetWidth;
            let roomHeight = document.querySelector('.walkable').offsetHeight;

            if (newLeft >= 0 && newLeft + playerChar.offsetWidth <= roomWidth) {
                playerChar.style.left = newLeft + 'px';
            }

            if (newTop >= 0 && newTop + playerChar.offsetHeight <= roomHeight) {
                playerChar.style.top = newTop + 'px';
            }

            requestAnimationFrame(moveCharacter);
        }

        requestAnimationFrame(moveCharacter);
    </script>
</body>
</html>
